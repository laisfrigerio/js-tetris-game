"use strict";var I=[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0]]],J=[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]],L=[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]],O=[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]],S=[[[0,1,1],[1,1,0],[0,0,0]],[[0,1,0],[0,1,1],[0,0,1]],[[0,0,0],[0,1,1],[1,1,0]],[[1,0,0],[1,1,0],[0,1,0]]],T=[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]],Z=[[[1,1,0],[0,1,1],[0,0,0]],[[0,0,1],[0,1,1],[0,1,0]],[[0,0,0],[1,1,0],[0,1,1]],[[0,1,0],[1,1,0],[1,0,0]]],PIECES=[[I,"red"],[J,"blue"],[L,"orange"],[O,"green"],[S,"violet"],[T,"yellow"],[Z,"brown"]],SQUARE_SIZE=20,ROW=20,COLUMN=10,VACANT="black",KEY_LEFT=37,KEY_RIGHT=39,KEY_DOWN=40,KEY_UP=38;function Square(t){this.SQUARE_SIZE=t}function Board(t,e,i){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.boardMatrix=e,this.square=i}function Piece(t,e,i){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:3,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:-1;this.tetromino=t,this.index=0,this.activeTetromino=this.tetromino[this.index],this.color=e,this.board=i,this.x=o,this.y=r}Square.prototype.drawSquare=function(t,e,i,o){t.fillStyle=o,t.fillRect(e*this.SQUARE_SIZE,i*this.SQUARE_SIZE,this.SQUARE_SIZE,this.SQUARE_SIZE),t.strokeStyle="black",t.strokeRect(e*this.SQUARE_SIZE,i*this.SQUARE_SIZE,this.SQUARE_SIZE,this.SQUARE_SIZE)},Board.prototype.createBoard=function(){for(var t=0;t<ROW;t++){this.boardMatrix[t]=[];for(var e=0;e<COLUMN;e++)this.boardMatrix[t][e]=VACANT}},Board.prototype.drawBoard=function(){for(var t=0;t<ROW;t++)for(var e=0;e<COLUMN;e++)this.square.drawSquare(this.ctx,e,t,this.boardMatrix[t][e])},Piece.prototype.fill=function(t){for(var e=0;e<this.activeTetromino.length;e++)for(var i=0;i<this.activeTetromino.length;i++)this.activeTetromino[e][i]&&this.board.square.drawSquare(this.board.ctx,this.x+i,this.y+e,t)},Piece.prototype.draw=function(){this.fill(this.color)},Piece.prototype.unDraw=function(){this.fill(VACANT)},Piece.prototype.down=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"right";this.collision(0,1,t)?(this.lock(),fillNextPiece(nextPiece,VACANT),piece=nextPiece,fillNextPiece(nextPiece=randomNextPiece())):(this.unDraw(),this.y++,this.draw())},Piece.prototype.moveRight=function(){this.collision(1,0)||(this.unDraw(),this.x++,this.draw())},Piece.prototype.moveLeft=function(){this.collision(-1,0)||(this.unDraw(),this.x--,this.draw())},Piece.prototype.rotate=function(){var t=this.tetromino[(this.index+1)%this.tetromino.length],e=0;this.collision(0,0,t)&&(e=this.x>COLUMN/2?-1:1),this.collision(e,0,t)||(this.unDraw(),this.x+=e,this.index=(this.index+1)%this.tetromino.length,this.activeTetromino=this.tetromino[(this.index+1)%this.tetromino.length],this.draw())},Piece.prototype.collision=function(t,e,i){for(var o=0;o<this.activeTetromino.length;o++)for(var r=0;r<this.activeTetromino.length;r++)if(this.activeTetromino[o][r]){var n=this.x+t+r,a=this.y+e+o;if(n<0||COLUMN<=n||ROW<=a)return!0;if(!(a<0)&&this.board.boardMatrix[a][n]!==VACANT)return!0}return!1},Piece.prototype.lock=function(){for(var t=0;t<this.activeTetromino.length;t++)for(var e=0;e<this.activeTetromino.length;e++)if(this.activeTetromino[t][e]){if(this.y+t<0){PAUSE=GAME_OVER=!0,alert("Game over");break}this.board.boardMatrix[this.y+t][this.x+e]=this.color}for(var i=0,o=0;o<ROW;o++){for(var r=!0,n=0;n<COLUMN;n++)r=r&&this.board.boardMatrix[o][n]!==VACANT;if(r){i++;for(var a=o;1<a;a--){for(var c=0;c<COLUMN;c++)this.board.boardMatrix[a][c]=this.board.boardMatrix[a-1][c];this.board.boardMatrix[8][10]=this.board.boardMatrix[7][10];for(var s=0;s<COLUMN;s++)this.board.boardMatrix[0][s]=VACANT}}}SCORE+=10*i,setScore(),this.board.drawBoard()};var hour=0,minute=0,second=0,hourID=document.querySelector("#hour"),minuteID=document.querySelector("#minute"),secondID=document.querySelector("#second"),interval=null;function startTimer(){interval=window.setInterval(function(){PAUSE||updateTimer()},1e3)}function updateTimer(){59===minute&&(minute=second=0,hour++),59===second&&(minute++,second=0),second++,hourID.innerText=hour<10?0+String(hour):String(hour),minuteID.innerText=minute<10?0+String(minute):String(minute),secondID.innerText=second<10?0+String(second):String(second)}function clearTimer(){clearInterval(interval),second=minute=hour=0,interval=null}var GAME_OVER=!1,PAUSE=!1,RESTART=!1,SCORE=0,DROP_START=Date.now(),boardMatrix=[],square=new Square(SQUARE_SIZE),board=new Board("tetris",boardMatrix,square),piece=null,nextPiece=null;function CONTROL(t){checkKey(t.which)}function checkKey(t){PAUSE||(t===KEY_LEFT?(piece.moveLeft(),DROP_START=Date.now()):t===KEY_UP?(piece.rotate(),DROP_START=Date.now()):t===KEY_RIGHT?(piece.moveRight(),DROP_START=Date.now()):t===KEY_DOWN&&(piece.down("down"),DROP_START=Date.now()))}function randomNextPiece(){var t=Math.floor(Math.random()*PIECES.length);return new Piece(PIECES[t][0],PIECES[t][1],board)}function drop(){1e3<Date.now()-DROP_START&&(piece.down(),DROP_START=Date.now()),GAME_OVER||PAUSE||requestAnimationFrame(drop)}function start(){piece=randomNextPiece(),nextPiece=randomNextPiece(),board.createBoard(),board.drawBoard(),piece.draw(board.ctx),fillNextPiece(nextPiece),startTimer(),drop()}function setScore(){document.getElementById("score-span").innerText=""+SCORE}function fillNextPiece(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t.color,i=document.getElementById("next-piece").getContext("2d"),o=0;o<t.activeTetromino.length;o++)for(var r=0;r<t.activeTetromino.length;r++)t.activeTetromino[o][r]&&(i.fillStyle=e,i.fillRect(r*SQUARE_SIZE,o*SQUARE_SIZE,SQUARE_SIZE,SQUARE_SIZE),i.strokeStyle="black",i.strokeRect(r*SQUARE_SIZE,o*SQUARE_SIZE,SQUARE_SIZE,SQUARE_SIZE))}start(),window.addEventListener("keydown",CONTROL),document.querySelector("#pause").addEventListener("click",function(){PAUSE&&requestAnimationFrame(drop),PAUSE=!PAUSE}),document.querySelector("#left").addEventListener("click",function(){checkKey(KEY_LEFT)}),document.querySelector("#right").addEventListener("click",function(){checkKey(KEY_RIGHT)}),document.querySelector("#down").addEventListener("click",function(){checkKey(KEY_DOWN)}),document.querySelector("#up").addEventListener("click",function(){checkKey(KEY_UP)}),document.querySelector("#restart").addEventListener("click",function(){GAME_OVER=PAUSE=!(RESTART=!(SCORE=0)),setScore(),clearTimer(),start()});